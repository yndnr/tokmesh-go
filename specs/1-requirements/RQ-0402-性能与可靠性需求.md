# RQ-0402-性能与可靠性需求

**状态**: 已批准
**优先级**: P1
**来源**: Interactive
**最后更新**: 2025-12-17

## 1. 概述
本文档汇总 TokMesh 服务的非功能性需求 (NFR)，包括性能、可靠性、容量和安全指标。这些指标是架构设计和验收测试的关键依据。

## 2. 性能目标 (Performance)

### 2.1 吞吐量 (Throughput)
- **单节点**: ≥ **10,000 TPS** (Write/Auth mixed)。
- **线性扩展**: 集群吞吐量应随节点数线性增长 (效率损失 < 20%)。

### 2.2 延迟 (Latency)
- **局域网 P99**: < **10ms**。
- **局域网 P95**: < **5ms**。
- **冷启动**: 进程启动至 Ready 状态 < **5s**。

### 2.3 资源占用 (Resource)
- **内存**: 默认配置下空闲占用 < **512MB**。
- **CPU**: 在 1000 TPS 负载下，CPU 占用应 < 1 Core。

## 3. 可靠性 (Reliability)

### 3.1 可用性 (Availability)
- **SLA**: **99.9%** (单月停机 < 43m)。
- **故障恢复**: 节点宕机后，集群应在 **30s** 内完成故障检测和流量切换。

### 3.2 数据持久性 (Durability)
- **RPO (Recovery Point Objective)**: < **1s** (在开启 WAL 模式下)。
- **RTO (Recovery Time Objective)**: < **30s**。

## 4. 容量规划 (Capacity)

### 4.1 规模
- **单节点会话数**: 支持 **500万** 活跃会话。
- **集群规模**: 支持至少 **100 节点** 规模。

## 5. 验收标准 (Acceptance Criteria)

1.  **基准测试**:
    - [ ] 使用 `wrk` 或 `hey`（HTTP 压测）进行压测，单节点达到 10,000 TPS。
    - [ ] 压测期间 P99 延迟 < 10ms。
2.  **稳定性**:
    - [ ] 72小时长稳测试，内存无泄漏，TPS 无明显抖动。
