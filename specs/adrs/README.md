# 架构决策记录（ADR）索引

本目录包含 TokMesh 项目的架构决策记录（ADR），使用 `AD-LEVseq-slug.md` 分层编号规则。

---

## 什么是ADR？

ADR（Architecture Decision Record）记录项目中的重要技术决策，包括：
- 决策的上下文和背景
- 考虑的选项
- 最终决策及理由
- 决策的后果

## 为什么需要ADR？

- 知识传承：团队成员变动时保留决策历史
- 避免重复讨论：已决策的问题不再反复争论
- 决策可追溯：了解为什么当初这么做
- 复盘依据：后续评估决策效果

## ADR格式

使用 `AD-<LEV><seq>-<slug>.md` 分层编号模板，包含：

1. 标题：AD-{LEV}{seq}-{简短描述}
2. 状态：提议中/已接受/已废弃/已替代
3. 上下文：决策的背景和动机
4. 决策：最终选择的方案
5. 后果：正面后果、负面后果、缓解措施
6. 备选方案：考虑过但未采用的其他方案

## 按分层（LEV）组织的 ADR 索引

ADR 同样使用 `AD-LEVseq-slug.md` 规则，`LEV` 含义与 RQ/DS/TK 保持一致。

### 第一层：系统基础（LEV = 01）

> 与核心数据模型、存储结构等基础能力相关的决策

| 编号 | 标题 | 状态 | 日期 | 关联文档 |
|------|------|------|------|----------|
| [AD-0101](AD-0101-Token生成与存储策略.md) | Token 生成与存储策略 | 已接受 | 2025-12-12 | RQ-0101, RQ-0301~0302, DS-0101 |
| [AD-0102](AD-0102-并发Map选型决策.md) | 并发 Map 选型决策 | 已接受 | 2025-12-12 | DS-0101 |
| [AD-0103](AD-0103-依赖包治理与白名单.md) | 依赖包治理与白名单 | 已接受 | 2025-12-16 | 全局（约束 Gin/Viper 等依赖引入） |

### 第二层：安全基础（LEV = 02）

> 与加密、密钥管理、安全机制相关的决策

| 编号 | 标题 | 状态 | 日期 | 关联文档 |
|------|------|------|------|----------|
| [AD-0201](AD-0201-自适应加密算法决策.md) | 自适应加密算法决策 | 已接受 | 2025-12-12 | RQ-0201, DS-0101 |

### 第三层：接口与集成（LEV = 03）

> 与对外接口、协议选型相关的决策

| 编号 | 标题 | 状态 | 日期 | 关联文档 |
|------|------|------|------|----------|
| [AD-0301](AD-0301-HTTP框架选型演进.md) | HTTP 框架选型演进 | 已替代 | 2025-12-15 | DS-0301 |
| [AD-0302](AD-0302-对外接口协议与HTTP实现裁决.md) | 对外接口协议与HTTP实现裁决 | 已接受 | 2025-12-15 | DS-0301, RQ-0301 |

### 第四层：架构与质量（LEV = 04）

> 与分布式架构、集群一致性、性能与可靠性等相关的决策

| 编号 | 标题 | 状态 | 日期 | 关联文档 |
|------|------|------|------|----------|
| [AD-0401](AD-0401-集群元数据持久化引擎选型策略.md) | 集群元数据持久化引擎选型策略 | 已接受 | 2025-12-16 | DS-0401 |
| [AD-0402](AD-0402-嵌入式KV选型策略.md) | 嵌入式 KV 选型策略 | 已接受 | 2025-12-16 | DS-0401 |

### 第五层：运维与交付（LEV = 05）

> 与配置管理、CLI、部署相关的决策

| 编号 | 标题 | 状态 | 日期 | 关联文档 |
|------|------|------|------|----------|
| [AD-0501](AD-0501-配置与CLI框架选型.md) | 配置与CLI框架选型 | 已接受 | 2025-12-15 | DS-0502, DS-0601, RQ-0502 |

## 创建新ADR

1. 复制 template.md 模板
2. 按分层编号规则命名（例如 `AD-0103-...`、`AD-0202-...`）
3. 填写各部分内容
4. 提交PR进行评审
5. 评审通过后合并

## ADR修改原则

- 已接受的ADR原则上不修改
- 如需变更决策，创建新ADR并标记旧ADR为"已替代"
- 轻微的补充说明可以追加，但不改变核心决策

---

维护者：[架构委员会]
更新日期：2025-12-15
---
