# TokMesh 设计文档索引

本目录包含 TokMesh 项目的全部技术设计文档，与需求文档（RQ 系列）一一对应。

---

## 文档结构

设计文档按需求文档的六层结构组织，确保需求-设计完整对应。

---

## 第一层：系统基础

> 回答 **"HOW"** - 如何实现核心数据模型和生命周期

| 编号 | 名称 | 来源需求 | 核心内容 |
|------|------|----------|----------|
| **[DS-0101](DS-0101-核心数据模型设计.md)** | 核心数据模型设计 | RQ-0101, RQ-0102 | Session 结构、Token 哈希、内存索引、WAL、快照、TTL 清理 |

---

## 第二层：安全基础

> 回答 **"HOW"** - 如何实现安全与鉴权

| 编号 | 名称 | 来源需求 | 核心内容 |
|------|------|----------|----------|
| **[DS-0201](DS-0201-安全与鉴权设计.md)** | 安全与鉴权设计 | RQ-0201 | API Key 管理、Argon2 验证、缓存、防重放、限流、数据加密 |

---

## 第三层：接口规范

> 回答 **"HOW"** - 如何实现多协议接口

| 编号 | 名称 | 来源需求 | 核心内容 |
|------|------|----------|----------|
| **[DS-0301](DS-0301-接口与协议层设计.md)** | 接口与协议层设计 | specs/governance/error-codes.md, RQ-0301~0303 | 对外 HTTP/HTTPS(stdlib)、集群内部 Connect+Protobuf、中间件链、错误码映射 |
| **[DS-0302](DS-0302-管理接口设计.md)** | 管理接口设计 | RQ-0304 | Admin API、Key 管理、备份恢复、审计日志、集群管理 |

---

## 第四层：架构与质量

> 回答 **"HOW"** - 如何实现分布式架构和可观测性

| 编号 | 名称 | 来源需求 | 核心内容 |
|------|------|----------|----------|
| **[DS-0401](DS-0401-分布式集群架构设计.md)** | 分布式集群架构设计 | RQ-0401 | Raft 控制面、一致性哈希、vNode、数据复制、再平衡、故障检测 |
| **[DS-0402](DS-0402-可观测性设计.md)** | 可观测性设计 | RQ-0403 | OpenTelemetry 追踪、Prometheus 指标、JSON 日志、告警规则 |

---

## 第五层：运维与交付

> 回答 **"HOW"** - 如何部署和配置

| 编号 | 名称 | 来源需求 | 核心内容 |
|------|------|----------|----------|
| **[DS-0501](DS-0501-部署与运维设计.md)** | 部署与运维设计 | RQ-0501 | 交付物规范、systemd/Windows Service、Docker/K8s、端口规划 |
| **[DS-0502](DS-0502-配置管理设计.md)** | 配置管理设计 | RQ-0502 | 配置加载、多源合并、结构化验证、TLS 热加载 |

---

## 第六层：CLI 工具

> 回答 **"HOW"** - 如何通过命令行管理系统

| 编号 | 名称 | 来源需求 | 核心内容 |
|------|------|----------|----------|
| **[DS-0601](DS-0601-CLI总体设计.md)** | CLI总体设计 | RQ-0304 | 架构、输出格式、错误处理、命令树 |
| **[DS-0602](DS-0602-CLI交互模式与连接管理.md)** | CLI交互模式与连接管理 | RQ-0602 | 双模式、connect/disconnect、配置文件 |
| **[DS-0603](DS-0603-CLI-session.md)** | CLI-session | RQ-0301 | session 子命令详细设计 |
| **[DS-0604](DS-0604-CLI-apikey.md)** | CLI-apikey | RQ-0201, RQ-0602 | apikey 子命令：创建、列表、轮转、删除 |
| **[DS-0605](DS-0605-CLI-config.md)** | CLI-config | RQ-0502, RQ-0602 | config 子命令：本地配置、远程配置查看 |
| **[DS-0606](DS-0606-CLI-backup.md)** | CLI-backup | RQ-0304, RQ-0602 | backup 子命令：快照、恢复 |
| **[DS-0607](DS-0607-CLI-system.md)** | CLI-system | RQ-0304, RQ-0602 | system 子命令：状态、健康检查、维护 |

---

## 第七层：客户端接入（LEV = 06）

> 回答 **"HOW"** - 开发者如何接入（当前范围：HTTP/HTTPS + `tokmesh-cli`；不包含官方 SDK）

| 编号 | 名称 | 来源需求 | 核心内容 |
|------|------|----------|----------|
| DS-0601 | CLI 总体设计 | RQ-0602 | 连接管理、交互模式、命令布局 |
| DS-0602 | CLI 交互模式与连接管理 | RQ-0602 | socket/http(s) 目标、配置搜索顺序、安全约束 |
| DS-0603 | CLI 会话命令 | RQ-0602 | session 子命令与示例 |
| DS-0604 | CLI API Key 命令 | RQ-0602 | apikey 管理 |
| DS-0605 | CLI 配置命令 | RQ-0502/RQ-0602 | config server test/diff/reload 等 |
| DS-0606 | CLI 备份命令 | RQ-0501/RQ-0602 | snapshot/restore 等 |
| DS-0607 | CLI 系统命令 | RQ-0602 | status/health 等 |

---

## 需求-设计覆盖矩阵

| 需求 | 设计 | 覆盖状态 |
|------|------|----------|
| RQ-0101 核心数据模型 | DS-0101 | ✅ |
| RQ-0102 会话生命周期管理 | DS-0101 | ✅ (合并) |
| specs/governance/error-codes.md 全局错误码规范 | DS-0301 | ✅ (含错误码映射) |
| RQ-0201 安全与鉴权体系 | DS-0201 | ✅ |
| RQ-0301 业务接口规约-OpenAPI | DS-0301 | ✅ |
| RQ-0303 业务接口规约-Redis协议 | DS-0301 | ✅ |
| RQ-0304 管理接口规约 | DS-0302 | ✅ |
| RQ-0401 分布式集群架构 | DS-0401 | ✅ |
| RQ-0402 性能与可靠性需求 | DS-0101, DS-0301, DS-0401 | ✅ (显式引用) |
| RQ-0403 可观测性需求 | DS-0402 | ✅ |
| RQ-0501 部署与交付需求 | DS-0501 | ✅ |
| RQ-0502 配置管理需求 | DS-0502 | ✅ |
| RQ-0602 CLI交互模式与连接管理 | DS-0602~0607 | ✅ |

---

## 关联文档

- **需求文档**: [specs/1-requirements/](../1-requirements/)
- **架构决策**: [specs/adrs/](../adrs/)
- **治理规范**: [specs/governance/](../governance/)

---

维护者: Claude Code
更新日期: 2025-12-15
重组版本: v2.0 (与需求文档层次对齐)
