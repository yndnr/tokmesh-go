# TK-0501-初始化工程骨架

**状态**: 已完成
**优先级**: P0
**范围**: 代码仓库初始化（Pre-coding → Coding）
**关联需求**: `specs/1-requirements/RQ-0501-部署与交付需求.md`, `specs/1-requirements/RQ-0502-配置管理需求.md`
**关联设计**: `specs/2-designs/DS-0501-部署与运维设计.md`, `specs/2-designs/DS-0502-配置管理设计.md`, `specs/2-designs/DS-0301-接口与协议层设计.md`
**关联决策**: `specs/adrs/AD-0302-对外接口协议与HTTP实现裁决.md`, `specs/adrs/AD-0501-配置与CLI框架选型.md`
**完成日期**: 2025-12-17

---

## 1. 目标

- 建立 TokMesh 代码目录结构与 Go 模块基础，满足后续各功能任务可按设计落地。
- 约束：不实现业务功能，仅完成工程骨架与可运行的最小占位。

## 2. 关键决策点

- ✅ Go module 路径：`github.com/yndnr/tokmesh-go`

## 3. 交付物

> **完整目录结构详见 [specs/governance/code-skeleton.md](../governance/code-skeleton.md)**

- ✅ 新增 `src/` 目录及基础工程结构（按 `specs/governance/conventions.md` 与 Go 规范）
- ✅ 初始化 `src/go.mod`、`src/go.sum`
- ✅ 可执行程序目录：
  - `src/cmd/tokmesh-server/main.go`
  - `src/cmd/tokmesh-cli/main.go`
- ✅ 核心目录结构：
  - `src/internal/core/` - 核心域（domain + service）
  - `src/internal/storage/` - 存储层（memory + wal + snapshot）
  - `src/internal/server/` - 服务端（httpserver, redisserver, clusterserver, localserver, config）
  - `src/internal/cli/` - CLI（command, connection, repl, output, config）
  - `src/internal/telemetry/` - 可观测性（logger, metric, tracer）
  - `src/internal/infra/` - 基础设施（confloader, buildinfo, tlsroots, shutdown）
  - `src/pkg/` - 公共库（token, crypto, cmap）

## 4. 验收标准

- [x] `src/go.mod` 存在且模块可被 `go list ./...` 正常解析
- [x] `cmd/tokmesh-server` 与 `cmd/tokmesh-cli` 包含可编译的 `main`
- [x] 目录命名符合 `specs/governance/conventions.md`（避免 `http/grpc/redis` 等高冲突包名）
- [x] 不引入与当前裁决冲突的依赖

## 5. 子任务完成情况

1. [x] 创建 `src/` 目录与基础结构
2. [x] 初始化 Go 模块（`go mod init github.com/yndnr/tokmesh-go`）
3. [x] 为两个可执行程序创建 `main`
4. [x] 建立 `internal/server/config` 与 `internal/cli/config` 配置结构
5. [x] 建立 `internal/server/httpserver` 结构
6. [x] 建立 `internal/cli/` 完整目录结构（command, connection, repl, output, config）
7. [x] 建立 `internal/storage/` 独立存储层
8. [x] 建立 `internal/infra/` 基础设施层
9. [x] 建立 `pkg/` 公共库

## 6. 备注

- 本任务已完成，后续进入各模块功能实现阶段
- 代码骨架共约 70 个占位文件，覆盖全部设计模块

---

## 变更历史

| 日期 | 变更说明 |
|------|----------|
| 2025-12-17 | 任务完成，更新状态和交付物清单 |
| 2025-12-15 | 初始创建 |
