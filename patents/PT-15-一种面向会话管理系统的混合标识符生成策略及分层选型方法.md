# PT-15 一种面向会话管理系统的混合标识符生成策略及分层选型方法

**专利编号**: PT-15
**技术领域**: 标识符生成
**创新性评估**: 中
**关联文档**: RQ-0101, AD-0104
**状态**: 草稿
**创建日期**: 2025-12-18

---

## 一、技术领域

本发明涉及分布式系统标识符设计领域，具体涉及一种面向会话管理系统的混合标识符生成策略及分层选型方法。

---

## 二、背景技术

### 2.1 现有技术的缺陷

1. **UUID方案**：36字符冗长，无时间信息，难以排序
2. **自增ID**：分布式环境下难以协调，存在安全风险
3. **统一方案**：一种方案难以同时满足标识符和凭证的不同需求

---

## 三、发明内容

### 3.1 技术方案

**分层策略**：根据用途选择不同的生成算法

| 用途 | 算法 | 特点 |
|------|------|------|
| 标识符（Session ID, API Key ID） | ULID | 时间排序、紧凑（26字符） |
| 凭证（Token, API Secret） | CSPRNG | 高熵（256位）、不可预测 |

**ULID特点**：
- 48位时间戳 + 80位随机数
- 26字符（Base32），比UUID短28%
- 按时间排序，便于调试

**CSPRNG凭证特点**：
- 32字节（256位）密码学安全随机数
- Base64URL编码，43字符
- 无时间信息，不可预测

### 3.2 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                   ID 生成器                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  标识符类（可追踪、可排序）:                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │  Session ID: tms-01ARZ3NDEKTSV4RRFFQ69G5FAV     │   │
│  │  API Key ID: tmk-01ARZ3NDEKTSV4RRFFQ69G5FAV     │   │
│  │                                                  │   │
│  │  算法: ULID                                      │   │
│  │  格式: 前缀 + ULID (26字符)                      │   │
│  │  特点: 时间排序、紧凑、便于调试                   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  凭证类（高熵、不可预测）:                               │
│  ┌─────────────────────────────────────────────────┐   │
│  │  Token:      tmt_a3f8b2c1d4e5f6g7h8i9j0k1...    │   │
│  │  API Secret: tms_x7y8z9w0v1u2t3s4r5q6p7...     │   │
│  │                                                  │   │
│  │  算法: CSPRNG                                    │   │
│  │  格式: 前缀 + Base64URL (43字符)                 │   │
│  │  特点: 256位熵、不可预测、防暴力破解             │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.3 有益效果

1. **各取所长**：标识符可排序可追踪，凭证高熵安全
2. **存储高效**：ULID比UUID节省28%空间
3. **调试友好**：从Session ID可推断创建时间
4. **安全性强**：凭证无时间可预测性

---

## 四、具体实施方式

```go
// 标识符生成（ULID）
func GenerateSessionID() string {
    return "tms-" + ulid.Make().String()
}

func GenerateAPIKeyID() string {
    return "tmk-" + ulid.Make().String()
}

// 凭证生成（CSPRNG）
func GenerateToken() string {
    b := make([]byte, 32)
    crypto_rand.Read(b)
    return "tmt_" + base64.RawURLEncoding.EncodeToString(b)
}

func GenerateAPISecret() string {
    b := make([]byte, 32)
    crypto_rand.Read(b)
    return "tms_" + base64.RawURLEncoding.EncodeToString(b)
}
```

---

## 五、权利要求书

### 权利要求1（独立权利要求）

一种面向会话管理系统的混合标识符生成方法，其特征在于：

**S1**：对于标识符类数据（Session ID、API Key ID），使用ULID算法生成，包含时间戳信息，支持时间排序；

**S2**：对于凭证类数据（Token、API Secret），使用密码学安全随机数生成器生成256位随机数，不包含可预测信息；

**S3**：使用不同前缀区分标识符类型和敏感度。

---

## 六、摘要

本发明公开了一种面向会话管理系统的混合标识符生成策略。标识符类数据（Session ID、API Key ID）使用ULID算法生成，包含时间戳，支持排序，比UUID节省28%空间；凭证类数据（Token、API Secret）使用CSPRNG生成256位随机数，高熵不可预测。解决了单一方案难以同时满足可追踪性和安全性需求的问题。

**关键词**：ULID；CSPRNG；混合策略；标识符生成；分层选型
